<!DOCTYPE html>
<html>
  <head>
    <title>WeatherDisplay2</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">    
    
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <script>
  // Get user latitude and longitude coordinates.
  navigator.geolocation.getCurrentPosition(savePosition);

  function savePosition(position) {
    // Create the XMLHttpRequest object
    const xhttp = new XMLHttpRequest();

    // Specify the type of request and the url.  
    xhttp.open("POST", "/weathers");
    
    // Set the request header.  POST requires 'Content-Type'.  Also set to JSON format
    xhttp.setRequestHeader('Content-Type', 'application/json');

    // Send the request to the server.  Reset all values as they are unknown and we need something to display.
    const parameters = {latitude: position.coords.latitude, longitude: position.coords.longitude};
    xhttp.send(JSON.stringify(parameters));
  }
  </script>

  <body>
    <button class="bi" onClick="changeIcon()"><img id="iconImg" src="/assets/3moon.png" /></button>

  <script>
    function changeIcon() {

      // Toggle the background color from black to white.
      var element = document.body; 
      element.classList.toggle("dark-mode");

      // Change the icon image 
      const iconImg = document.getElementById("iconImg");
      if (iconImg.src.includes("moon")) {
        iconImg.src = "/assets/sun4.jpg";
      } else {  
        iconImg.src = "/assets/3moon.png"};  
    }
  </script>

    <%= yield %>
  </body>
</html>
